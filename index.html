<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>FX CORE AUTO</title>

<style>
body {
  background: black;
  color: #00ffcc;
  font-family: monospace;
  text-align: center;
}

.box {
  border: 2px solid #00ffcc;
  margin: 20px;
  padding: 20px;
}

button {
  background: hotpink;
  color: black;
  padding: 15px 40px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>FX CORE AUTO</h1>

<div class="box">
  BUY SIZE <input id="buy" />
  SELL SIZE <input id="sell" />
</div>

<div class="box">ENV: <span id="env">--</span></div>
<div class="box">DIR: <span id="dir">--</span></div>
<div class="box">RSI SIGNAL: <span id="rsi">--</span></div>
<div class="box">ORDER: <span id="order">--</span></div>

<button onclick="autoAnalyze()">AUTO ANALYZE</button>

<script>

async function autoAnalyze() {
  try {
    const res = await fetch("/api/market");
    const data = await res.json();

    analyze(data);

  } catch (e) {
    console.log("API ERROR", e);
    alert("API取得失敗");
  }
}

function analyze(data) {

  // デフォサイズ
  document.getElementById("buy").value = 100;
  document.getElementById("sell").value = 250;

  // ===== ENV判定 =====
  let env = "RANGE";

  if (data.vix > 0.3) env = "RISK OFF";
  if (data.sp > 0.3 && data.vix < 0) env = "RISK ON";

  document.getElementById("env").innerText = env;

  // ===== DIR判定 =====
  let dir = "NEUTRAL";

  if (data.sp > 0 && data.dxy < 0) dir = "LONG";
  if (data.sp < 0 && data.dxy > 0) dir = "SHORT";

  document.getElementById("dir").innerText = dir;

  // ===== RSI判定 =====
  let rsiSignal = "NORMAL";

  if (data.rsi > 70) rsiSignal = "OVERBOUGHT";
  if (data.rsi < 30) rsiSignal = "OVERSOLD";

  document.getElementById("rsi").innerText = rsiSignal;

  // ===== ORDER判定 =====
  let order = "NO TRADE";

  if (env === "RISK ON" && dir === "LONG") order = "BUY";
  if (env === "RISK OFF" && dir === "SHORT") order = "SELL";

  document.getElementById("order").innerText = order;
}

</script>

</body>
</html>