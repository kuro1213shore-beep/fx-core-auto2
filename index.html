<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FX CORE AUTO</title>

<style>
body{
  background:black;
  color:#00ffc3;
  font-family:monospace;
  text-align:center;
}
h1{ margin-top:30px; }

.box{
  border:2px solid #00ffc3;
  margin:15px auto;
  padding:15px;
  width:90%;
  max-width:500px;
}

input{
  width:80px;
  text-align:center;
}

button{
  background:#ff3b7f;
  color:black;
  padding:10px 30px;
  border:none;
  margin-top:20px;
  font-weight:bold;
  cursor:pointer;
}

#tv_chart{
  margin:40px auto;
  max-width:900px;
}
</style>
</head>

<body>

<h1>FX CORE AUTO</h1>

<div class="box">
  BUY SIZE <input id="buySize" value="100">
  SELL SIZE <input id="sellSize" value="250">
</div>

<div class="box">USDJPY: <span id="usdPrice">--</span></div>
<div class="box">CHANGE: <span id="usdChange">--</span></div>
<div class="box">RSI: <span id="usdRsi">--</span></div>

<div class="box">ENV: <span id="env">--</span></div>
<div class="box">DIR: <span id="dir">--</span></div>
<div class="box">RSI SIGNAL: <span id="rsiSignal">--</span></div>
<div class="box">ORDER: <span id="order">--</span></div>

<button onclick="autoAnalyze()">AUTO ANALYZE</button>

<!-- ğŸ”¥ TradingView -->
<div id="tv_chart"></div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script>
new TradingView.widget({
  "width": "100%",
  "height": 500,
  "symbol": "FX:USDJPY",
  "interval": "15",
  "timezone": "Asia/Tokyo",
  "theme": "dark",
  "style": "1",
  "locale": "en",
  "container_id": "tv_chart"
});
</script>

<script>

let timer = null;

/* ===== RSIè¨ˆç®— ===== */
function calculateRSI(closes, period=14){
  let gains=0, losses=0;
  for(let i=1;i<=period;i++){
    const diff=closes[i]-closes[i-1];
    if(diff>=0) gains+=diff;
    else losses-=diff;
  }
  const avgGain=gains/period;
  const avgLoss=losses/period;
  if(avgLoss===0) return 100;
  const rs=avgGain/avgLoss;
  return 100-(100/(1+rs));
}

/* ===== APIå–å¾— ===== */
async function autoAnalyze(){
  try{

    // ğŸ”¥ ç„¡æ–™ç‚ºæ›¿API
    const priceRes = await fetch("https://api.exchangerate.host/latest?base=USD&symbols=JPY");
    const priceData = await priceRes.json();

    const usdJpy = priceData.rates.JPY;
    document.getElementById("usdPrice").innerText = usdJpy.toFixed(3);

    // å¤‰å‹•ãƒ€ãƒŸãƒ¼ï¼ˆç„¡æ–™APIã§ã¯å‰æ—¥æ¯”è¼ƒä¸å¯ï¼‰
    const change = (Math.random()*0.3-0.15);
    document.getElementById("usdChange").innerText = change.toFixed(3);

    // RSIç”¨ãƒ€ãƒŸãƒ¼çµ‚å€¤ç”Ÿæˆï¼ˆç„¡æ–™APIåˆ¶é™å¯¾ç­–ï¼‰
    let closes=[];
    for(let i=0;i<15;i++){
      closes.push(usdJpy + (Math.random()*0.5-0.25));
    }
    const rsi = calculateRSI(closes);
    document.getElementById("usdRsi").innerText = rsi.toFixed(1);

    analyze({
      sp:0.3,
      vix:-0.2,
      dxy:0.2,
      rsi:rsi
    });

  }catch(e){
    console.error(e);
  }
}

/* ===== åˆ†æãƒ­ã‚¸ãƒƒã‚¯ ===== */
function analyze(data){

  let env="RANGE";
  if(data.sp>0.5) env="RISK ON";
  if(data.vix>0.5) env="RISK OFF";
  document.getElementById("env").innerText=env;

  let dir="NEUTRAL";
  if(data.dxy>0.3) dir="USD STRONG";
  if(data.dxy<-0.3) dir="USD WEAK";
  document.getElementById("dir").innerText=dir;

  let rsiSignal="NORMAL";
  if(data.rsi>70) rsiSignal="OVERBOUGHT";
  if(data.rsi<30) rsiSignal="OVERSOLD";
  document.getElementById("rsiSignal").innerText=rsiSignal;

  let order="NO TRADE";
  if(env==="RISK ON" && dir==="USD WEAK") order="BUY";
  if(env==="RISK OFF" && dir==="USD STRONG") order="SELL";
  document.getElementById("order").innerText=order;
}

/* ===== è‡ªå‹•æ›´æ–° ===== */
function startAuto(){
  autoAnalyze();
  timer=setInterval(autoAnalyze,15000);
}
startAuto();

</script>

</body>
</html>